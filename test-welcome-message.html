<!DOCTYPE html>
<html>
<head>
    <title>Chat Test</title>
    <script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
</head>
<body>
    <div id="messagesList"></div>
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5000/chathub")
            .build();

        const messagesList = document.getElementById("messagesList");

        connection.on("ReceiveMessage", function (user, message, timestamp) {
            console.log("Received message:", { user, message, timestamp });
            const div = document.createElement("div");
            div.innerHTML = `<strong>${user}</strong> (${new Date(timestamp).toLocaleTimeString()}): ${message}`;
            messagesList.appendChild(div);
        });

        connection.start().then(function () {
            console.log("SignalR Connected!");
        }).catch(function (err) {
            console.error("SignalR Connection Error: ", err.toString());
        });

        function sendMessage() {
            const input = document.getElementById("userInput");
            const message = input.value.trim();
            if (message) {
                connection.invoke("SendMessage", "TestUser", message).catch(function (err) {
                    console.error("Send Error: ", err.toString());
                });
                input.value = "";
            }
        }

        document.getElementById("userInput").addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                sendMessage();
            }
        });
    </script>
</body>
</html>
