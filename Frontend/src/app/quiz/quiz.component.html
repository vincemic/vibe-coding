<div class="quiz-container">
  <!-- Header -->
  <div class="quiz-header">
    <div class="header-content">
      <h1>🎯 Ultimate Quiz Challenge</h1>
      <div class="connection-status" [class.connected]="isConnected()">
        <span class="status-dot"></span>
        {{ connectionStatus }}
      </div>
    </div>
    <div class="header-actions">
      <button class="back-button" (click)="backToChat()">← Back to Chat</button>
      <button 
        *ngIf="players.length > 0" 
        class="leaderboard-button" 
        (click)="toggleLeaderboard()">
        📊 Scores
      </button>
    </div>
  </div>

  <!-- Progress bar for active game -->
  <div *ngIf="currentQuestion" class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
    </div>
    <span class="progress-text">
      Question {{ currentQuestion.questionNumber }} of {{ currentQuestion.totalQuestions }}
    </span>
  </div>

  <!-- Main Content -->
  <div class="quiz-content">
    
    <!-- Joining State -->
    <div *ngIf="currentState === QuizState.Joining" class="join-section">
      <div class="welcome-card">
        <h2>🎮 Ready to Test Your Knowledge?</h2>
        <p>Join up to 10 players in this exciting quiz challenge!</p>
        <div class="join-form">
          <input 
            type="text" 
            [(ngModel)]="playerName" 
            placeholder="Enter your name to join..."
            (keydown.enter)="joinGame()"
            [disabled]="isJoining"
            class="name-input">
          <button 
            (click)="joinGame()" 
            [disabled]="!playerName.trim() || isJoining"
            class="join-button">
            {{ isJoining ? 'Joining...' : 'Join Game' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Waiting for Players -->
    <div *ngIf="currentState === QuizState.WaitingForPlayers" class="waiting-section">
      <div class="waiting-card">
        <h2>🎉 Welcome {{ currentPlayer?.name }}!</h2>
        <p>Waiting for more players to join...</p>
        <div class="player-count">
          <strong>{{ players.length }}/10 Players</strong>
        </div>
        <div *ngIf="players.length >= 2" class="start-hint">
          <p>✨ Game will start automatically with {{ players.length }} players!</p>
        </div>
      </div>
    </div>

    <!-- Game Starting -->
    <div *ngIf="currentState === QuizState.Starting" class="starting-section">
      <div class="starting-card">
        <h2>🚀 Game Starting!</h2>
        <p>Get ready for {{ currentQuestion?.totalQuestions || 10 }} exciting questions!</p>
        <div class="countdown">3</div>
      </div>
    </div>

    <!-- Question Display -->
    <div *ngIf="currentState === QuizState.QuestionDisplay" class="question-section">
      <div class="question-card" *ngIf="currentQuestion">
        <div class="question-header">
          <span class="category">{{ currentQuestion.question.category }}</span>
          <span class="question-number">{{ currentQuestion.questionNumber }}/{{ currentQuestion.totalQuestions }}</span>
        </div>
        <h2 class="question-text">{{ currentQuestion.question.question }}</h2>
        <div class="question-preparation">
          <p>📚 Read the question carefully...</p>
          <p>⏰ Answer options coming up in a few seconds!</p>
        </div>
      </div>
    </div>

    <!-- Waiting for Answers -->
    <div *ngIf="currentState === QuizState.WaitingForAnswers" class="answer-section">
      <div class="answer-card" *ngIf="currentQuestion">
        <div class="question-header">
          <span class="category">{{ currentQuestion.question.category }}</span>
          <div class="timer" [class.urgent]="timeRemaining <= 10">
            ⏰ {{ timeRemaining }}s
          </div>
        </div>
        
        <h3 class="question-text">{{ currentQuestion.question.question }}</h3>
        
        <div class="answer-options">
          <button 
            *ngFor="let option of currentQuestion.question.options; let i = index"
            class="option-button"
            [class.selected]="selectedAnswer === i"
            [class.disabled]="hasAnswered"
            (click)="submitAnswer(i)"
            [disabled]="hasAnswered">
            <span class="option-letter">{{ getOptionLetter(i) }}</span>
            <span class="option-text">{{ option }}</span>
          </button>
        </div>
        
        <div class="answer-status">
          <div *ngIf="!hasAnswered" class="not-answered">
            🤔 Choose your answer above
          </div>
          <div *ngIf="hasAnswered" class="answered">
            ✅ Answer submitted! Waiting for others...
          </div>
          <div class="progress-info">
            {{ answeredCount }}/{{ totalPlayers }} players answered
          </div>
        </div>
      </div>
    </div>

    <!-- Question Results -->
    <div *ngIf="currentState === QuizState.ShowingResults" class="results-section">
      <div class="results-card" *ngIf="questionResult">
        <h2>📊 Question {{ (currentQuestion?.questionNumber || 1) }} Results</h2>
        
        <div class="correct-answer">
          <h3>✅ Correct Answer: {{ getOptionLetter(questionResult.correctAnswer) }}</h3>
          <p class="answer-text">{{ questionResult.question.options[questionResult.correctAnswer] }}</p>
          <p class="explanation">{{ questionResult.explanation }}</p>
        </div>
        
        <div class="player-results">
          <h4>Player Performance:</h4>
          <div class="result-list">
            <div 
              *ngFor="let result of questionResult.playerResults" 
              class="player-result"
              [class.correct]="result.isCorrect"
              [class.current-player]="result.playerId === currentPlayer?.id">
              <span class="player-name">{{ result.playerName }}</span>
              <span class="player-answer">
                {{ result.selectedOption >= 0 ? getOptionLetter(result.selectedOption) : '❌' }}
              </span>
              <span class="score-gained" *ngIf="result.scoreGained > 0">
                +{{ result.scoreGained }}
              </span>
              <span class="total-score">{{ result.totalScore }} pts</span>
            </div>
          </div>
        </div>

        <div class="next-question">
          <p>🔄 Next question coming up...</p>
        </div>
      </div>
    </div>

    <!-- Game Over -->
    <div *ngIf="currentState === QuizState.GameOver" class="gameover-section">
      <div class="gameover-card" *ngIf="finalResults">
        <h2>🏁 Game Complete!</h2>
        
        <div *ngIf="finalResults.winner" class="winner-announcement">
          <h3>🏆 Champion: {{ finalResults.winner.playerName }}!</h3>
          <p class="winner-score">Final Score: {{ finalResults.winner.totalScore }} points</p>
          <div *ngIf="finalResults.winner.playerId === currentPlayer?.id" class="victory-message">
            🎉 Congratulations! You are the Quiz Master! 🎉
          </div>
        </div>
        
        <div class="final-leaderboard">
          <h4>📊 Final Leaderboard:</h4>
          <div class="leaderboard-list">
            <div 
              *ngFor="let player of finalResults.finalScores; let i = index" 
              class="leaderboard-item"
              [class.winner]="i === 0"
              [class.current-player]="player.playerId === currentPlayer?.id">
              <span class="rank">{{ i + 1 }}</span>
              <span class="name">{{ player.playerName }}</span>
              <span class="score" [style.color]="getScoreColor(player.totalScore)">
                {{ player.totalScore }} pts
              </span>
            </div>
          </div>
        </div>

        <div class="game-stats">
          <h4>📈 Game Statistics:</h4>
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">Duration:</span>
              <span class="stat-value">{{ finalResults.statistics.gameDuration }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Players:</span>
              <span class="stat-value">{{ finalResults.statistics.totalPlayers }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Questions:</span>
              <span class="stat-value">{{ finalResults.statistics.totalQuestions }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Avg Score:</span>
              <span class="stat-value">{{ finalResults.statistics.averageScore | number:'1.0-0' }}</span>
            </div>
          </div>
        </div>

        <div class="game-actions">
          <button class="play-again-button" (click)="playAgain()">
            🔄 Play Again
          </button>
          <button class="back-button" (click)="backToChat()">
            💬 Back to Chat
          </button>
        </div>
      </div>
    </div>

    <!-- Side Panel: Leaderboard -->
    <div *ngIf="showLeaderboard && players.length > 0" class="leaderboard-panel">
      <div class="panel-header">
        <h3>🏆 Current Scores</h3>
        <button class="close-button" (click)="toggleLeaderboard()">×</button>
      </div>
      <div class="current-leaderboard">
        <div 
          *ngFor="let player of players; let i = index" 
          class="leaderboard-entry"
          [class.current-player]="player.id === currentPlayer?.id">
          <span class="rank">{{ i + 1 }}</span>
          <span class="name">{{ player.name }}</span>
          <span class="score">{{ player.score }}</span>
          <span *ngIf="player.hasAnswered" class="answered-indicator">✅</span>
        </div>
      </div>
    </div>

  </div>

  <!-- Quiz Master Messages -->
  <div class="quiz-master-panel">
    <div class="panel-header">
      <h3>🤖 Quiz Master</h3>
    </div>
    <div class="messages-container">
      <div 
        *ngFor="let message of quizMasterMessages" 
        class="quiz-message">
        <div class="message-content">{{ message.message }}</div>
        <div class="message-timestamp">{{ message.timestamp | date:'HH:mm:ss' }}</div>
      </div>
    </div>
  </div>

</div>
